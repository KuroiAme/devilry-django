{% extends "devilry_group/base.django.html" %}

{% load custom_filter %}
{% load crispy_forms_tags %}

{% block body %}

<!-- Content -->

    <div class="container">
        <div class="row">

            <div class="feedback_header">

                    <div class="col-sm-7 text-left">
                        <h4><strong>{{ assignment.long_name }}</strong></h4>
                        <h5>{{ subject.long_name }} {{ period.long_name }}</h5>
                    </div>
                    <div class="col-sm-5 text-right">
                        <h4>CURRENT DEADLINE</h4>
                        {% if current_date >= last_feedbackset.deadline_datetime %}
                                <h5 class="current_deadline_expired">expired - {{ last_deadline }}</h5>
                        {% else %}
                            <h5>{{ last_deadline }}</h5>
                        {% endif %}
                    </div>

            </div>
        </div>


        <div class="row">

            <!--
            Sidebar
            -->
            <dl class="col-sm-12 col-md-4 feedback_sidebar_not_fixed pull-right">
                {% block sidebar %}
                    <dl class="top_headline">
                        <h4>UPLOADED FILES</h4>
                    </dl>
                        {% for feedbackset in feedbacksets %}
                            <dl class="sub_headline">
                                <h5>
                                    {{ ''|devilry_verbosenumber:forloop.counter }} DEADLINE
                                </h5>
                            </dl>
                            {% for comment in feedbackset.groupcomment_set.all %}
                                {% for file in comment.commentfile_set.all %}
                                    <dl class="feedback_sidebar_files">
                                        <a href="#" ><p>{{ file.filename|devilry_truncatefileextension:26 }}</p></a>
                                    </dl>
                                {% endfor %}
                            {% endfor %}
                        {% endfor %}

                    <br>

                    <dl class="top_headline">
                        <h4>TEXT FORMATTING TOOLS</h4>
                    </dl>
                    <dl class="top_headline">
                        <h4>CODE FORMATTING TOOLS</h4>
                    </dl>
                    <dl class="top_headline">
                        <h4>MATH FORMATTING TOOLS</h4>
                    </dl>
                {% endblock sidebar %}
            </dl>

            <div class="col-sm-12 col-md-8 pull-left feedback_feed">
                {% block feed %}

                    {% for timestamp, eventlist in timeline.items %}
                        {% for event in eventlist %}

                            <!--
                            Handle comments events
                            -->
                            {% if event.type == "comment" %}
                                {% with event.obj as comment %}
                                    <div class="
                                        {% if comment.user_role == "student" %}
                                            student_comment
                                        {% elif comment.user_role == "examiner"%}
                                            examiner_comment
                                        {% elif comment.user_role == "admin"%}
                                            admin_comment
                                        {% endif %}">
                                        <div class="left_field">
                                            <div class="comment-meta">
                                                <div class="comment_created_by"><p>{{ comment.user }}&nbsp;</p></div>
                                                <div class="comment_created_by_role"><p>({{ comment.user_role }})&nbsp;</p></div>
                                                <div class="comment_created_date"><p> {{ comment.published_datetime }}</p></div>
                                            </div>
                                            <div class="comment_text">
                                                <p>{{ comment.text }}</p>
                                            </div>
                                            {% for file in comment.commentfile_set.all %}
                                                <div class="file_icon"><p>{{ file.filename }}</p></div>
                                            {% endfor %}
                                        </div>
                                        {% if not comment.instant_publish and not comment.feedback_set.published_datetime %}
                                            <div class="not_published_badge">
                                                <p class="badge_text">NOT PUBLISHED</p>
                                            </div>
                                        {% elif comment.user_role == "student" and comment.published_datetime > comment.feedback_set.deadline_datetime %}
                                            <div class="after_deadline_badge">
                                                <p class="badge_text">NOT PART OF DELIVERY</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endwith %}

                                <!--
                                Handle the deadline events
                                -->
                                {% elif event.type == "deadline_created" %}
                                    <div class="event_message">
                                        <p>
                                            {{ timestamp }}: {{ event.user }} created a new deadline: <strong>{{ event.obj }}</strong>
                                        </p>
                                    </div>
                                {% elif event.type == "deadline_expired" %}
                                    <div class="event_message">
                                        <p>
                                            {{ timestamp }}: <strong>Deadline expired</strong>
                                        </p>
                                    </div>

                                <!--
                                Handle feedback grade events
                                -->
                                {% elif event.type == "grade" %}
                                    {% if event.obj >= assignment.passing_grade_min_points %}
                                        <div class="event_message_passed">
                                            <p>{{ timestamp }}: This delivery was corrected, and given the grade
                                                <strong>{{ event.obj }}/{{ assignment.max_points }} (passed)</strong>
                                            </p>
                                        </div>
                                    {% else %}
                                        <div class="event_message_failed">
                                            <p>
                                                {{ timestamp }}: This delivery was corrected, and given the grade
                                                <strong>{{ event.obj }}/{{ assignment.max_points }} (failed)</strong>
                                            </p>
                                        </div>
                                    {% endif %}
                            {% endif %}

                        {% endfor %}
                    {% endfor %}


                    <br>
                    <br>
                    <br>
                    <br>
                    {% crispy form formhelper %}
                    <br>
                    <br>
                    <br>
                    <br>


                {% endblock feed %}
              </div>



{% endblock body %}



{#<br>#}
{#<br>#}
{#<br>#}
{#<br>#}
{#<form method="post" class="uniform">#}
{#    {% crispy form formhelper %}#}
{#</form>#}
{#<br>#}
{#<br>#}
{#<br>#}
{#<br>#}
{##}
{#{% for timestamp, eventlist in timeline.items %}#}
{#    {% for event in eventlist %}#}
{#        {% if event.type == "comment" %}#}
{#            {% with event.obj as comment %}#}
{#                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12#}
{#                    {%  if comment.user_role == "student" %}#}
{#                        student-comment-style#}
{#                    {%  elif comment.user_role == "examiner" %}#}
{#                        examiner-comment-style#}
{#                    {%  elif comment.user_role == "admin" %}#}
{#                    {% endif %}">#}
{#                        <div class="col-xs-10 col-sm-10 col-md-10 pull-left left-field-style">#}
{#                            <div class="row">#}
{#                                <div class="col-xs-12 col-sm-12 col-md-12 created-by-info">#}
{#                                    <div class="row">#}
{##}
{#                                        <div class="col-xs-12 col-sm-12 col-md-4">#}
{#                                            <h4 class="created-by">{{ comment.user }}</h4>#}
{#                                        </div>#}
{##}
{#                                        <div class="col-xs-12 col-sm-12 col-md-8">#}
{#                                            <h4 class="created-by-meta">({{ comment.user_role }}) - {{ comment.published_datetime }}</h4>#}
{#                                        </div>#}
{##}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="row">#}
{#                                <div class="col-xs-12 col-sm-12 col-md-12">#}
{#                                    <p>#}
{#                                        {{ comment.text }}#}
{#                                    </p>#}
{#                                    {% for file in comment.commentfile_set.all %}#}
{#                                        <div class="file_icon">{{ file.filename }}</div>#}
{#                                    {% endfor %}#}
{#                                </div>#}
{#                            </div>#}
{##}
{#                        </div>#}
{##}
{#                        {% if not comment.instant_publish and not comment.feedback_set.published_datetime %}#}
{#                            <div class="col-xs-2 col-sm-2 col-md-2 pull-right text-center not-published-badge">#}
{#                                    <strong><p>NOT PUBLISHED</p></strong>#}
{#                            </div>#}
{#                        {% elif comment.user_role == "student" and comment.published_datetime > comment.feedback_set.deadline_datetime %}#}
{#                            <div class="col-xs-2 col-sm-2 col-md-2 pull-right text-center after-deadline-badge">#}
{#                                    <p>NOT PART OF DELIVERY</p>#}
{#                            </div>#}
{#                        {% endif %}#}
{#                </div>#}
{#            {% endwith %}#}
{##}
{#        {% elif event.type == "deadline_created" %}#}
{#                <p class="event_message">{{ timestamp }}: {{ event.user }} created a new deadline: <strong>{{ event.obj }}</strong></p>#}
{#        {% elif event.type == "deadline_expired" %}#}
{#            <p class="event_message">{{ timestamp }}: <strong>Deadline expired</strong></p>#}
{#        {% elif event.type == "grade" %}#}
{#            {% if event.obj >= assignment.passing_grade_min_points %}#}
{#                <p class="event_message_passed">{{ timestamp }}: This delivery was corrected, and given the grade <strong>{{ event.obj }}/{{ assignment.max_points }} (passed)</strong></p>#}
{#            {% else %}#}
{#                <p class="event_message_failed">{{ timestamp }}: This delivery was corrected, and given the grade <strong>{{ event.obj }}/{{ assignment.max_points }} (failed)</strong></p>#}
{#            {% endif %}#}
{#        {% endif %}#}
{#    {% endfor %}#}
{#{% endfor %}#}
{##}
{#{% endblock feed %}#}